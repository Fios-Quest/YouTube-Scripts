<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Clippy and Friends - IRISS Scripts</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">IRISS Scripts</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="clippy-and-fmt"><a class="header" href="#clippy-and-fmt">Clippy and Fmt</a></h1>
<p>The Rust ecosystem has a wealth of tools that support us when writing Rust but there are two important tools I want to talk about before we get back to the "real programming": Rust format and Clippy.</p>
<p>As ever, this series is accompanied by a free book, check the description for a link straight to this chapter.</p>
<p>My name is Daniel, welcome to IRISS.</p>
<hr />
<p>Rust Format, helps us keep our code styles consistent, so that its easy to share your code or read and learn from someone else's.</p>
<p>Clippy helps spot common mistakes and antipatterns, and can even make suggestions on things like performance, scalability or readability improvements.</p>
<p>But, this is a lot of tools, how can we use them to not only improve our code, but learn to be better developers.</p>
<p>Let's go through them one by one.</p>
<h2 id="rustfmt"><a class="header" href="#rustfmt">rustfmt</a></h2>
<p><code>rustfmt</code> is a formatting tool for Rust.</p>
<p>Programming language formatting tools allow you to configure how you want your code to look. For example:</p>
<ul>
<li>
<p>Do you like opening curly brakets on the end of a line</p>
</li>
<li>
<p>or on a new line:</p>
</li>
<li>
<p>Do you indent with four spaces</p>
</li>
<li>
<p>or two:</p>
</li>
<li>
<p>Does the last item in a list across multiple lines have a trailing comma:</p>
</li>
<li>
<p>or not:</p>
</li>
<li>
<p>How many empty lines are allowed between lines of code in a function?</p>
</li>
<li>
<p>And so on</p>
</li>
</ul>
<p>Maintaining a consistent style improves the legibility of code, making it faster for engineers to read and understand what's happening.</p>
<p>This is true, even if you only write code for yourself, using familiar patterns reduces the cognitive load to parse what you're looking at.</p>
<p>When working together as a group, it's important to come to an agreement as to how you will style your code together, but luckily a Formatter will reduce the burden of having to maintain the style once you've picked what to use.</p>
<p>Now, different languages have different "styles" that they follow.</p>
<p>Some older languages may have multiple well established styles to choose from.</p>
<p>Luckily there's an official Rust Style Guide which gives us all a compelling reason to write code the same way.</p>
<p>Not only that, but, "Rust Format" comes with the tool suite, and will automatically maintain the style for you!</p>
<p>You can call Rust Format manually using <code>cargo fmt</code> and it will automatically reformat your entire project, however its definitely best if you can set your IDE to automatically run it any time you save a file.</p>
<p>In VSCode we do it like this...</p>
<p>This will save us any big, unexpected changes.</p>
<p>If you just want it to simply tell you if anything is incorrectly formatted without changing your files, you can use <code>cargo fmt --check</code>.</p>
<p>We'll come back to why this is so useful later!</p>
<p>Finally, it might be that you and your team find some aspect of the official Rust Style Guide particularly egregious, and that's fine (been there, believe me)!</p>
<p>Rust Format allows you to configure how it will format your code through Rust Format toml.</p>
<p>You can find a complete guide to what you can control on the Rust Format github page, which I've linked in the description.</p>
<h2 id="clippy"><a class="header" href="#clippy">clippy</a></h2>
<p>Clippy is a name that might bring a lot of anxiety to for millennials and boomers or anyone working with Microsoft Office around the turn of the century, and yes, this Clippy is named after that one.</p>
<p>Clippy, in this case, is Rust's linter, a tool that can not only make sure your code is correct (I mean, <code>rustc</code> technically already does <em>that</em> for you) but even offer suggestions on how to improve your code, and explain why an alternative might be better!</p>
<p>To run Clippy with the default configuration, simply type <code>cargo clippy</code></p>
<p>This is an incredibly powerful tool, not just for making sure your code is the best it can be, but as an aid for learning how to get the best out of Rust.</p>
<p>Perhaps antithetical to that, though still incredibly useful, Clippy can go right ahead and fix many of the common issues it might find, simply by passing the <code>--fix</code> flag.</p>
<p>Obviously I recommend making sure you understand the changes it's suggesting before allowing it to proceed.</p>
<p>And, Clippy won't just check your <em>code</em> either, it can also spot common mistakes in your documentation (we love documentation here if you couldn't tell 😅).</p>
<p>For example, if in your doc comments you use underscores or double colons outside of backticks (which would be used to express code), Clippy will assume this is a mistake and let you know.</p>
<p>There's a lot of flexibility in how you can configure Clippy.</p>
<p>Lints are broken up into groups for easy control, so we typically might decide at the group level, what to include, and whether it should be considered a warning or completely denied.</p>
<p>For example, I tend to include a group of lints called <code>pedantic</code>  with a warning (these are usually allowed by clippy which means you don't get told if there is a potential issue).</p>
<p>I don't particularly recommend <em>starting</em> with this, but if you want to do this you can either:</p>
<ul>
<li>add the line warn clippy pedantic to your project entry point
or...</li>
<li>run: <code>cargo clippy -- -W clippy::pedantic</code></li>
</ul>
<p>The benefit of the first option is that you can set a nice default for the project without you or anyone else needing to remember what options to pass to Clippy</p>
<p>The latter is useful if you want to override that or any other behaviour.</p>
<p>For a full list of lints, check Clippy's website, I've linked it in the description.</p>
<h2 id="cargo-check"><a class="header" href="#cargo-check">Cargo Check</a></h2>
<p>There's one last tool I want to mention, and it will initially seem quite underwhelming by comparison to the others, but stick with me.</p>
<p><code>cargo check</code> is a tool which... checks your code and all its dependencies for errors.</p>
<p>Groundbreaking, right?</p>
<p>I mean, we'd find out that our code has errors when we try to build it with <code>cargo build</code>, so what's the point of <code>cargo check</code>?</p>
<p>Well, <code>cargo check</code> essentially does the same job as <code>cargo build</code> but skips the final step of code generation.</p>
<p>This means it's faster, and importantly, cheaper to perform, so it can be used as a fast-fail.</p>
<p>The work it does isn't wasted either.</p>
<p>Because it does in fact perform some of the compilation steps, the output of this is cached on your machine so that other tools (such as <code>cargo build</code> and Clippy) can use that to skip earlier steps in their own processes.</p>
<p>This might not seem very useful on your machine, but it comes in very handy with Continuous Integration.</p>
<h2 id="continuous-integration"><a class="header" href="#continuous-integration">Continuous Integration</a></h2>
<p>Continuous Integration (or CI) is a technique that we use to maintain high quality, robust, and "correct" code in our code base.</p>
<p>CI is usually used to help control what goes into your Software Configuration Management system (or SCM), where you might be storing your code.</p>
<p>SCM systems like Git, Mercurial, Subversion, et cetera, are out of scope for this series, however, if you haven't already, you should learn to use one of these as quickly as possible.</p>
<p>I can't tell you which to use though as it depends on what kind of application you're building.</p>
<p>Git is very common, and it's what I use for most things, including managing these scripts, but it's better for things that are being <em>primarily</em> built from text based resources, like websites, or desktop applications.</p>
<p>If you're making games or something that uses a lot of images or other non-text based assets though you might want to use Subversion, Plastic or Perforce.</p>
<p>Whatever you choose, you can use Continuous Integration to make sure that every time you make changes, those changes make your project better, and minimise the risk of them making things worse.</p>
<p>How you achieve this will vary depending on not only what SCM you use, but potentially who hosts it.</p>
<p>GitLab and GitHub are both Git services, but GitLab CI is very different from GitHub Actions.</p>
<p>The main idea however is to run a set of instructions before allowing changes to be integrated (or merged) into the main project.</p>
<p>For example, a typical Git workflow might have a <code>main</code> branch.</p>
<p>When you come to do some work, you'd create a new branch based on what's currently in <code>main</code> and name it something relevant to the work you're going to do (for example, when I wrote this chapter of the book, I was on a branch called <code>clippy-and-fmt</code>).</p>
<p>When you're happy with your code, you would merge your branch with <code>main</code> and <code>main</code> would get all of your changes.</p>
<p>This is where CI helps, it makes sure that whatever you're doing on your branch is up to the level of quality that is expected of code in <code>main</code>.</p>
<p>We can use the tools we've talked about in this and previous chapters to create a CI workflow.</p>
<p>Roughly what we want to do is:</p>
<ol>
<li>run <code>cargo check</code>, if this fails, there's not a lot of point in continuing, so we get our results faster</li>
<li>run <code>cargo fmt --check</code> which will make sure code abides by our style guide without changing anything</li>
<li>run <code>cargo clippy -- -D warnings</code> which errors out if there are any warnings from clippy
<blockquote>
<p>Remember, although warnings don't necessarily mean something is actually wrong, you should try to make sure you
to fix them all anyway as the more irrelevant warnings you're outputting, the more likely it is that you'll miss
something that is relevant!</p>
</blockquote>
</li>
<li><code>cargo test</code> will run all tests and doc tests</li>
<li><code>cargo build</code> will make sure your code actually compiles
<blockquote>
<p>This can also be very useful in a Continuous Deployment processes, after merging to main, allowing you to
immediately deploy your latest code automatically</p>
</blockquote>
</li>
</ol>
<p>Running all of this one after the other can be very time-consuming, but some of it can be run in parallel.</p>
<p><code>cargo check</code> and <code>cargo fmt</code> do not depend on anything else, and can act as fast fails, letting you know that it's not worth continuing the process.</p>
<p><code>cargo test</code> and <code>cargo clippy</code> are only going to work if <code>cargo check</code> also works, so as soon as <code>cargo check</code> is complete, we can start working on them</p>
<p>Finally, once <code>cargo test</code> and <code>cargo clippy</code> have succeeded, we can move to the final check, <code>cargo build</code>.</p>
<p>At this point, everything that could be caught should have been caught so there should be no surprises which means we might as well wait for <code>cargo fmt</code> to complete too.</p>
<p>Depending on your CI suite though, it might be that each of these tasks runs in isolation, for example, it might run each step in a docker container.</p>
<p>But, <code>cargo check</code> is going to do a lot of hard work some of the other steps can use.</p>
<p>This is where its worth learning your CI suite's caching process, so that you can cache the output of the <code>cargo check</code> step.</p>
<h2 id="next-time"><a class="header" href="#next-time">Next Time</a></h2>
<p>I know I keep saying you don't pay software engineers to code, you pay us to solve problems, but we usually solve those problems with code, so it's about time we got back to it!</p>
<p>Next time we're going to look at Traits with everyone's favorite guest star!</p>
<p>If that sounds good, don't forget to like and subscribe.</p>
<p>And I'll see you next time. 👋🏻</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../iriss/007-iriss.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../iriss/009-iriss.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../iriss/007-iriss.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../iriss/009-iriss.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
